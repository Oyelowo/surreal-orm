<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Struct Attributes - Surreal ORM</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Powerful &amp; expressive ORM/query-builder/static checker for raw queries/Fully Automated migration tooling , designed to offer an intuitive API, strict type-checking, novel features, &amp; full specification support. It provides a fresh perspective in data management. Currently supports SurrealDB engine. RDMSs(PG, MYSQL etc) and others coming soon">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Surreal ORM</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/oyelowo/surreal_orm" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="node-attributes-on-struct"><a class="header" href="#node-attributes-on-struct">Node Attributes on Struct</a></h1>
<p>In Surreal ORM, node attributes provide a convenient mechanism to dictate the
behavior and structure of database tables and their associated fields. These
attributes are not only powerful tools for developers but also help in
maintaining a consistent and clear database schema. This chapter will delve into
the intricacies of node attributes, their application, and best practices for
their usage.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><a href="#introduction-to-node-attributes">Introduction to Node Attributes</a></li>
<li><a href="#working-with-node-attributes">Working with Node Attributes</a>
<ul>
<li><a href="#supported-table-attributes">Supported Table Attributes</a></li>
</ul>
</li>
<li><a href="#node-attributes-examples">Node Attributes: Examples</a>
<ul>
<li><a href="#auto-inferred-table-name">Auto-Inferred Table Name</a></li>
<li><a href="#explicit-table-name">Explicit Table Name</a></li>
<li><a href="#using-define-for-inline-table-definition">Using <code>define</code> for Inline Table Definition</a></li>
<li><a href="#using-define_fn-for-external-function-definition">Using <code>define_fn</code> for External Function Definition</a></li>
<li><a href="#specifying-permissions">Specifying Permissions</a></li>
</ul>
</li>
<li><a href="#ensuring-valid-usage-of-node-attributes">Ensuring Valid Usage of Node Attributes</a>
<ul>
<li><a href="#conflicting-definitions">Conflicting Definitions</a></li>
<li><a href="#avoid-excessive-attributes-with-define-or-define_fn">Avoid Excessive Attributes with <code>define</code> or <code>define_fn</code></a></li>
<li><a href="#consistent-table-naming">Consistent Table Naming</a></li>
<li><a href="#using-functions-for-attributes">Using Functions for Attributes</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<hr />
<h2 id="introduction-to-node-attributes"><a class="header" href="#introduction-to-node-attributes">Introduction to Node Attributes</a></h2>
<p>Node attributes in Surreal ORM allow developers to:</p>
<ul>
<li>Rename fields of a struct according to a naming convention.</li>
<li>Explicitly set or infer the table name.</li>
<li>Enforce schema structures.</li>
<li>Handle table drops and recreations.</li>
<li>Create table projections or views.</li>
<li>Set granular permissions for CRUD operations on tables.</li>
<li>Define the table structure either inline or through external functions.</li>
</ul>
<h2 id="working-with-node-attributes"><a class="header" href="#working-with-node-attributes">Working with Node Attributes</a></h2>
<h3 id="supported-table-attributes"><a class="header" href="#supported-table-attributes">Supported table attributes</a></h3>
<h2 id="struct-attributes"><a class="header" href="#struct-attributes">Struct Attributes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Description</th><th>Type</th><th>Optional</th></tr></thead><tbody>
<tr><td>rename_all</td><td>Renames all the struct's fields according to the given case convention. The possible values are "lowercase", "UPPERCASE", "PascalCase", "camelCase", "snake_case", "SCREAMING_SNAKE_CASE".</td><td>string</td><td>Y</td></tr>
<tr><td>table</td><td>Explicitly define the table name. By default, it must correspond with the struct name in snake_case. Use <code>relax_table</code> if you want to opt out of this but not encouraged.</td><td>Option<String></td><td>Y</td></tr>
<tr><td>relax_table</td><td>Determines whether the struct's name is matched to the table name as the snake case by default. This is not encouraged. Using your struct 1:1 to your database tables helps to ensure uniquness and prevent confusion.</td><td>Option<bool></td><td>Y</td></tr>
<tr><td>schemafull</td><td>Make the table enforce a schema struct.</td><td>Option<bool></td><td>Y</td></tr>
<tr><td>drop</td><td>Drop the table if it exists and create a new one with the same name.</td><td>Option<bool></td><td>Y</td></tr>
<tr><td>as</td><td>Inline statement e.g <code>select(All).from(user)</code> for creating a projection using the DEFINE TABLE statement. This is useful for copying data from an existing table in the new table definition. This is similar to making a view in a RDBMS.</td><td>A select statement</td><td>Y</td></tr>
<tr><td>as_fn</td><td>Same as above <code>as</code> but defined as external function from the struct e.g <code>select_reading_from_user</code> for creating a projection using the DEFINE TABLE statement. This is useful for copying data from an existing table in the new table definition. This is similar to making a view in a RDBMS.</td><td>A function name</td><td>Y</td></tr>
<tr><td>permissions</td><td>Specify permissions that apply to the table using the <code>for</code> statement.</td><td>ForStatement</td><td>Y</td></tr>
<tr><td>permissions_fn</td><td>Same as <code>permission</code> but as an external function from the struct. Specify permissions that apply to the table using the <code>for</code> statement.</td><td>ForStatement</td><td>Y</td></tr>
<tr><td>define</td><td>Generates a <code>DEFINE TABLE</code> statement for the table. This overrides other specific definitions to prevent confusion and collision. You can also invoke an external function directly rather than inlining the function e.g <code>define = "define_student()"</code></td><td>inline code string</td><td>Y</td></tr>
<tr><td>define_fn</td><td>Generates a <code>DEFINE TABLE</code> statement for the table. This overrides other specific definitions to prevent confusion and collision. Same as <code>define</code> attribute but expects the function name instead rather than invocation i.e <code>define_student</code> instead of <code>define_student()</code>. You can also invoke an external function directly rather than inlining the function e.g `define = "def</td><td></td><td></td></tr>
</tbody></table>
</div>
<h2 id="node-attributes-examples"><a class="header" href="#node-attributes-examples">Node Attributes: Examples</a></h2>
<h3 id="auto-inferred-table-name"><a class="header" href="#auto-inferred-table-name">Auto-Inferred Table Name</a></h3>
<p>By default, the ORM auto-infers the table name from the struct's name. For a
struct named <code>Alien</code>, the table name would be inferred as <code>alien</code>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
pub struct Alien {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>The corresponding table definition would be:</p>
<pre><code>DEFINE TABLE alien;
</code></pre>
<h3 id="explicit-table-name"><a class="header" href="#explicit-table-name">Explicit Table Name</a></h3>
<p>You can explicitly set the table name using the <code>table</code> attribute. By
default, the table name should be the snake case of the struct name. This is to
ensure consistency and uniqueness of table model struct. If you want a name
other than the snake case version, you need to add the attribute -
<code>relax_table</code>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
#[orm(table = "student_test")]
pub struct StudentTest {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>The corresponding table definition would be:</p>
<pre><code>DEFINE TABLE student_test;
</code></pre>
<h3 id="using-define-for-inline-table-definition"><a class="header" href="#using-define-for-inline-table-definition">Using <code>define</code> for Inline Table Definition</a></h3>
<p>The <code>define</code> attribute allows for inline table definitions, either through an
inline expression or an invoked external function.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
#[orm(table = "student_test_4", as_ = "select(All).from(Student::table())", define = "define_student()")]
pub struct StudentTest4 {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="using-define_fn-for-external-function-definition"><a class="header" href="#using-define_fn-for-external-function-definition">Using <code>define_fn</code> for External Function Definition</a></h3>
<p>Alternatively, the <code>define_fn</code> attribute points to an external function to
define the table:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
#[orm(table = "student_test_7", define_fn = "define_student")]
pub struct StudentTest7 {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="specifying-permissions"><a class="header" href="#specifying-permissions">Specifying Permissions</a></h3>
<p>The <code>permissions</code> attribute allows you to set granular permissions for CRUD
operations. This takes <code>Permissions</code> struct. Therefore, if you are using an
external function, it has to return <code>Permissions</code> which is then invoked and
passed in:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
#[orm(table = "student_test_5", permissions = "student_permissions()")]
pub struct StudentTest5 {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>In the example above, the <code>student_permissions()</code> function would define
permissions using the <code>for</code> statement from Surreal orm. <code>for</code> returns
<code>Permissions</code>.</p>
<h2 id="ensuring-valid-usage-of-node-attributes"><a class="header" href="#ensuring-valid-usage-of-node-attributes">Ensuring Valid Usage of Node Attributes</a></h2>
<p>While node attributes are powerful and flexible, their misuse can lead to
unexpected behaviors. Thankfully, the ORM actively checks for invalid usages and
ensures that developers don't misuse these attributes. Here are some guidelines
and checks enforced by the ORM to avoid pitfalls:</p>
<h3 id="conflicting-definitions"><a class="header" href="#conflicting-definitions"><strong>Conflicting Definitions</strong>:</a></h3>
<ul>
<li><strong><code>define</code> vs <code>define_fn</code></strong>: Using both <code>define</code> and <code>define_fn</code> attributes on
the same struct is not allowed . Only one should be present to define the
table.</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Node, Serialize, Deserialize)]
#[orm(table = "student_test_6", define_fn = "define_student", define = "define_student()")]
pub struct StudentTest6 {
    id: SurrealSimpleId&lt;Self&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>The ORM will raise an error for such definitions, ensuring clarity and
preventing conflicts.</p>
<hr />
<ul>
<li>
<p><strong><code>as</code> vs <code>as_fn</code></strong>: Only one of these should be used to define projections or
views.</p>
</li>
<li>
<p><strong><code>permissions</code> vs <code>permissions_fn</code></strong>: These attributes shouldn't coexist on
the same struct, choose one based on your need.</p>
</li>
<li>
<p><strong><code>value</code> vs <code>value_fn</code></strong> and <strong><code>assert</code> vs <code>assert_fn</code></strong>: Similar to the
above, only one of these pairs should be present on a struct.</p>
</li>
</ul>
<h3 id="avoid-excessive-attributes-with-define-or-define_fn"><a class="header" href="#avoid-excessive-attributes-with-define-or-define_fn"><strong>Avoid Excessive Attributes with <code>define</code> or <code>define_fn</code></strong>:</a></h3>
<p>When using <code>define</code> or <code>define_fn</code>, ensure no other attributes are present
except <code>table</code> and <code>relax_table</code>.</p>
<h3 id="consistent-table-naming"><a class="header" href="#consistent-table-naming"><strong>Consistent Table Naming</strong>:</a></h3>
<p>By default, the table name should be the snake case of the struct name. This is
to ensure consistency and uniqueness of table model struct. If you want a name
other than the snake case version, you need to add the attribute -
<code>relax_table</code>.</p>
<h3 id="using-functions-for-attributes"><a class="header" href="#using-functions-for-attributes"><strong>Using Functions for Attributes</strong>:</a></h3>
<p>When using attributes that invoke functions, such as
<code>define = "define_student()"</code>, ensure that the invoked function returns the
appropriate type. For instance, <code>define_student()</code> should return a
<code>DefineStatement</code> struct, and <code>student_permissions()</code> should return
<code>Permissions</code>.</p>
<h3 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h3>
<p>By following these guidelines and the checks enforced by the ORM, developers can
ensure a smooth and error-free database definition process. Remember, while the
ORM provides these checks, it's always a good practice for developers to
validate and review their implementations to guarantee best practices and avoid
potential pitfalls.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../concepts/node.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../concepts/node_field_attributes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../concepts/node.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../concepts/node_field_attributes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
