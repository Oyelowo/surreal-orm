<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parameters - Surreal ORM</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Surreal ORM</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="parameters"><a class="header" href="#parameters">Parameters</a></h1>
<p>Parameters in SurrealDB serve as essential tools for storing and manipulating
data within queries. The ORM simplifies this process, making it intuitive and
streamlined.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#query-creation-and-execution">Parameters in Query Creation and Execution</a></li>
<li><a href="#native-orm-parameters">Native ORM Parameters</a></li>
<li><a href="#advanced-parameter-name-creation">Advanced Parameter Name Creation</a></li>
</ul>
<h2 id="query-creation-and-execution"><a class="header" href="#query-creation-and-execution">Query Creation and Execution</a></h2>
<p>The ORM abstracts away much of the complexity involved in crafting queries. To
calculate the average strength of weapons, for instance:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let db = Surreal::new::&lt;Mem&gt;(()).await.unwrap();
</span><span class="boring">db.use_ns("test").use_db("test").await.unwrap();
</span><span class="boring">
</span><span class="boring">let ref weapon = Weapon::table();
</span><span class="boring">let weapon::Schema { ref strength, .. } = Weapon::schema();
</span><span class="boring">let weapon_stats::Schema {
</span><span class="boring">    averageStrength, ..
</span><span class="boring">} = WeaponStats::schema();
</span><span class="boring">
</span><span class="boring">let generated_weapons = (0..=14)
</span><span class="boring">    .map(|i| Weapon {
</span><span class="boring">        name: format!("weapon_{}", i),
</span><span class="boring">        strength: i,
</span><span class="boring">        ..Default::default()
</span><span class="boring">    })
</span><span class="boring">    .collect::&lt;Vec&lt;_&gt;&gt;();
</span><span class="boring">
</span><span class="boring">insert(generated_weapons).return_many(db.clone()).await?;
</span>

let created_stats_statement = create::&lt;WeaponStats&gt;().set(averageStrength.equal_to(block! {
    LET strengths = select_value(strength).from(weapon);
    LET total = math::sum!(strengths);
    LET count = count!(strengths);
    LET distance = 65;
    RETURN math::ceil!((((total / count) * (count * total)) / (total + 4)) * 100);
}));


assert_eq!(
    created_stats_statement.to_raw().build(),
    "CREATE weapon_stats SET averageStrength = {\n\
            LET $strengths = (SELECT VALUE strength FROM weapon);\n\n\
            LET $total = math::sum($strengths);\n\n\
            LET $count = count($strengths);\n\n\
            RETURN math::ceil(((($total / $count) * ($count * $total)) / ($total + 4)) * 100);\n\
            };"
);

assert_eq!(
    created_stats_statement.fine_tune_params(),
    "CREATE weapon_stats SET averageStrength = {\n\
            LET $strengths = $_param_00000001;\n\n\
            LET $total = math::sum($strengths);\n\n\
            LET $count = count($strengths);\n\n\
            RETURN math::ceil(((($total / $count) * ($count * $total)) / ($total + $_param_00000002)) * $_param_00000003);\n\
            };"
);
<span class="boring">}</span></code></pre></pre>
<p>This block of code demonstrates the ORM's ability to define and utilize
parameters within queries.</p>
<h2 id="native-orm-parameters"><a class="header" href="#native-orm-parameters">Native ORM Parameters</a></h2>
<p>SurrealDB provides a set of predefined variables designed to simplify query
development. While these predefined parameters can be utilized directly within
your queries, it's crucial to note that you cannot declare new parameters with
these specific names. The ORM is equipped with built-in functions that represent
these standard SurrealDB parameters. A function like <code>after()</code> corresponds to
the <code>$after</code> parameter in raw queries. These functions allow developers to
interact with the database at a high level, abstracting away the complexity of
raw queries.</p>
<p>To bridge this system with the ORM, these predefined variables are represented
by functions in the ORM, each mimicking the name of the corresponding parameter:</p>
<p>Here's a list of some of the prominent parameters and their descriptions:</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auth()</code></td><td><code>$auth</code></td><td>Represents the currently authenticated scope user.</td></tr>
<tr><td><code>token()</code></td><td><code>$token</code></td><td>Represents values held inside the JWT token used for the current session.</td></tr>
<tr><td><code>session()</code></td><td><code>$session</code></td><td>Values from session functions as an object.</td></tr>
<tr><td><code>before()</code></td><td><code>$before</code></td><td>Value before a field mutation.</td></tr>
<tr><td><code>after()</code></td><td><code>$after</code></td><td>Value post field mutation.</td></tr>
<tr><td><code>value()</code></td><td><code>$value</code></td><td>Post mutation value (identical to <code>$after</code> for events).</td></tr>
<tr><td><code>input()</code></td><td><code>$input</code></td><td>Initially inputted value in a field definition; the value clause might have modified the <code>$value</code> variable.</td></tr>
<tr><td><code>parent()</code></td><td><code>$parent</code></td><td>Parent record in a subquery.</td></tr>
<tr><td><code>event()</code></td><td><code>$event</code></td><td>Type of table event triggered on an event.</td></tr>
</tbody></table>
</div>
<p>These native functions simplify the query-writing process, enabling developers
to focus on the logic of their application without getting bogged down by the
intricacies of the database language.</p>
<h2 id="advanced-parameter-name-creation"><a class="header" href="#advanced-parameter-name-creation">Advanced Parameter Name Creation</a></h2>
<p>For those requiring further customization, the <code>create_param_name_fn!()</code> macro
is available. This macro not only aids in generating custom parameter names but
also supports field traversal using parameter paths. Typically though, you will
use this with the <code>define_param</code> statement when you want to define a constant
global variable. However, in a typical <code>let statement</code> (e.g used within the
<code>block!</code> macro), this is automatically handled.</p>
<p>Suppose you want to create a custom parameter name for a user's age. Using the
macro:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>create_param_name_fn!(user_age);
<span class="boring">}</span></code></pre></pre>
<p>If you would like to add a rust doc comment, you can do so as shown below:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>create_param_name_fn!(
    /// $user_age represents the age of a user
    =&gt; userAge
);
<span class="boring">}</span></code></pre></pre>
<p>To use the param name created above, you can invoke it as <code>user_age</code></p>
<p>This means that any parameter name created with this macro can be used for field
traversal. For more information on field traversal, refer to the
<a href="./concepts/field_traversal.html">Field Traversal chapter</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="operators.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="transactions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="operators.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="transactions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
