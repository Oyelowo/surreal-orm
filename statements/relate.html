<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Relate - Surreal ORM</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Powerful &amp; expressive ORM/query-builder/static checker for raw queries/Fully Automated migration tooling , designed to offer an intuitive API, strict type-checking, novel features, &amp; full specification support. It provides a fresh perspective in data management. Currently supports SurrealDB engine. RDMSs(PG, MYSQL etc) and others coming soon">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Surreal ORM</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/oyelowo/surreal_orm" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="relate-statement"><a class="header" href="#relate-statement">Relate Statement</a></h1>
<p>The <code>relate</code> statement is used to create relationships between different
entities in SurrealDB. It allows you to establish connections and associate data
between tables. Here are some examples and usage scenarios for the <code>relate</code>
statement.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#getting-relations">Getting Relations</a></li>
<li><a href="#valid-id-usage">Valid ID Usage</a></li>
<li><a href="#invalid-id-usage">Invalid ID Usage</a></li>
<li><a href="#relate-subquery-to-subquery">Relate Subquery to Subquery</a></li>
<li><a href="#any-edge-filter">Any Edge Filter</a></li>
<li><a href="#recursive-edge-to-edge-connection">Recursive Edge-to-Edge Connection</a></li>
<li><a href="#relate-query">Relate Query</a></li>
<li><a href="#relate-query-with-subquery">Relate Query with Subquery</a></li>
<li><a href="#using-set-method-with-object-macro-in-the-relate-statement">Using <code>set</code> Method with <code>object!</code> Macro in the <code>relate</code> Statement</a>
<ul>
<li><a href="#example-using-object-macro-with-set-in-relate">Example: Using <code>object!</code> Macro with <code>set</code> in <code>relate</code></a></li>
</ul>
</li>
<li><a href="#the-importance-of-the-object-macro-in-the-relate-statement">The Importance of the <code>object!</code> Macro in the <code>relate</code> Statement</a></li>
</ul>
<h2 id="getting-relations"><a class="header" href="#getting-relations">Getting Relations</a></h2>
<p>You can retrieve the relations and aliases for a specific field in a struct
using the <code>get_fields_relations_aliased</code> method. This example demonstrates how
to retrieve the relations and aliases for the <code>Student</code> struct:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let relations_aliases = Student::get_fields_relations_aliased();
<span class="boring">}</span></code></pre></pre>
<h2 id="valid-id-usage"><a class="header" href="#valid-id-usage">Valid ID Usage</a></h2>
<p>To create a relationship between entities using valid IDs, you can use the
<code>relate</code> statement. Here's an example of how to relate a student to a book:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let student_id = Student::create_id("1");
let book_id = Book::create_id("2");

let write_book = StudentWritesBook {
    time_written: Duration::from_secs(343),
    // other fields...
};

let relation = relate(Student::with(&amp;student_id).writes__(Empty).book(&amp;book_id))
    .content(write_book)
    .parallel();
<span class="boring">}</span></code></pre></pre>
<h2 id="invalid-id-usage"><a class="header" href="#invalid-id-usage">Invalid ID Usage</a></h2>
<p>When using invalid IDs in the <code>relate</code> statement, errors will be generated.
Here's an example of relating entities with invalid IDs:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let student_id = Student::create_id("oye");
let book_id = Book::create_id("mars");

let write = StudentWritesBook {
    time_written: Duration::from_secs(343),
    // other fields...
};

let relate_statement = relate(Student::with(&amp;book_id).writes__(Empty).book(&amp;student_id))
    .content(write.clone())
    .return_type(ReturnType::Before)
    .parallel();
<span class="boring">}</span></code></pre></pre>
<h2 id="relate-subquery-to-subquery"><a class="header" href="#relate-subquery-to-subquery">Relate Subquery to Subquery</a></h2>
<p>You can also use subqueries in the <code>relate</code> statement to establish relationships
between subquery results. Here's an example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let write = StudentWritesBook {
    time_written: Duration::from_secs(52),
    // other fields...
};

let statement = relate(
    Student::with(select(All).from(Student::get_table()))
        .writes__(E)
        .book(
            select(All).from(Book::get_table()),
        ),
)
.content(write.clone());
<span class="boring">}</span></code></pre></pre>
<h2 id="any-edge-filter"><a class="header" href="#any-edge-filter">Any Edge Filter</a></h2>
<p>The <code>any_other_edges</code> function allows you to filter relationships based on
multiple edge types. Here's an example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let aliased_connection = Student::with(student_id)
    .writes__(any_other_edges([visits, likes]).where_(timeWritten.less_than_or_equal(50)))
    .book(book_id)
    .__as__(Student::aliases().writtenBooks);
<span class="boring">}</span></code></pre></pre>
<h2 id="recursive-edge-to-edge-connection"><a class="header" href="#recursive-edge-to-edge-connection">Recursive Edge-to-Edge Connection</a></h2>
<p>You can create recursive edge-to-edge connections using the <code>relate</code> statement.
This allows you to select and relate entities at multiple levels. Here's an
example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let aliased_connection = Student::with(student_id)
    .writes__(Empty)
    .writes__(Empty)
    .writes__(any_other_edges(&amp;[writes, likes]).where_(timeWritten.less_than_or_equal(50)))
    .book(book_id)
    .__as__(Student::aliases().writtenBooks);
<span class="boring">}</span></code></pre></pre>
<h2 id="relate-query"><a class="header" href="#relate-query">Relate Query</a></h2>
<p>The <code>relate</code> statement can be used to execute a query and return the result.
Here's an example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let relate_simple = relate(Student::with(student_id).writes__(E).book(book_id)).content(write);
let relate_simple_object = relate_simple.return_one(db.clone()).await?;
let relate_simple_array = relate_simple.return_many(db.clone()).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="relate-query-with-subquery"><a class="header" href="#relate-query-with-subquery">Relate Query with Subquery</a></h2>
<p>You can also use subqueries in the <code>relate</code> statement to execute more complex
queries. Here's an example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let statement = relate(
    Student::with(select(All).from(Student::get_table()))
        .writes__(E)
        .book(
            select(All).from(Book::get_table()),
        ),
)
.content(write.clone());
<span class="boring">}</span></code></pre></pre>
<h3 id="using-set-method-with-object-macro-in-the-relate-statement"><a class="header" href="#using-set-method-with-object-macro-in-the-relate-statement">Using <code>set</code> Method with <code>object!</code> Macro in the <code>relate</code> Statement</a></h3>
<p>The <code>relate</code> statement supports the use of the <code>set</code> method, serving as an
alternative to the <code>content</code> method for specifying data when creating
relationships between entities.</p>
<p>The <code>set</code> method, when combined with the <code>object!</code> macro, offers a concise,
type-safe, and robust way to define the fields to be set during the relation
creation. Using the <code>object!</code> macro ensures that all fields are present, which
is crucial for avoiding serialization/deserialization issues arising from
missing fields or schema mismatches.</p>
<h4 id="example-using-object-macro-with-set-in-relate"><a class="header" href="#example-using-object-macro-with-set-in-relate">Example: Using <code>object!</code> Macro with <code>set</code> in <code>relate</code></a></h4>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let student_id = Student::create_id("1");
let book_id = Book::create_id("2");

relate(Student::with(&amp;student_id).writes__(Empty).book(&amp;book_id))
    .set(object!(StudentWritesBook {
        time_written: Duration::from_secs(343),
        // other fields...
    }))
    .parallel();
<span class="boring">}</span></code></pre></pre>
<h3 id="the-importance-of-the-object-macro-in-the-relate-statement"><a class="header" href="#the-importance-of-the-object-macro-in-the-relate-statement">The Importance of the <code>object!</code> Macro in the <code>relate</code> Statement</a></h3>
<p>In the context of the <code>relate</code> statement, the <code>object!</code> macro provides
significant advantages:</p>
<ol>
<li><strong>Type Safety:</strong> The <code>object!</code> macro ensures type safety, drastically
reducing the risk of type mismatches during compile-time.</li>
<li><strong>Full Field Coverage:</strong> Ensures that all fields are present, protecting
against potential issues during serialization/deserialization due to missing
fields or schema mismatches.</li>
<li><strong>Readability and Clarity:</strong> Using the <code>object!</code> macro leads to cleaner code.
By explicitly defining fields and their corresponding values, the code
becomes more understandable.</li>
<li><strong>Parameterized Fields:</strong> Supports the inclusion of parameters and fields,
making it especially valuable in transactional contexts within the <code>block!</code>
macro.</li>
</ol>
<p>Given these benefits, it's strongly recommended to utilize the <code>object!</code> macro
in the <code>relate</code> statement:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let relation_with_macro = relate(Student::with(&amp;student_id).writes__(Empty).book(&amp;book_id))
    .set(object!({
        timeWritten: Utc::now(),
        someOtherField: "Some Value",
        anotherField: "Another Value"
    }))
    .parallel();
<span class="boring">}</span></code></pre></pre>
<p>Prioritizing the use of the <code>object!</code> macro ensures a combination of safety,
clarity, and robustness in your development process.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../statements/update.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../statements/delete.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../statements/update.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../statements/delete.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
