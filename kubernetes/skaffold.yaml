apiVersion: skaffold/v2beta26
kind: Config
metadata:
  name: kubernetes
build:
  local:
    concurrency: 0
    tryImportMissing: true
    useDockerCLI: false
    useBuildkit: true
  artifacts:
  - image: oyelowo/react-web
    context: ../typescript
    docker:
      dockerfile: Dockerfile.development
      target: web
      noCache: false
      squash: false

  - image: oyelowo/graphql-mongo
    context: ../rust
    docker:
      dockerfile: Dockerfile.development
      target: graphql-mongo
      noCache: false
      squash: false
  #   requires:
  #     - image: builder-base
  #       alias: BASE

  # - image: oyelowo/graphql-postgres
  #   context: ../rust
  #   docker:
  #     dockerfile: Dockerfile.development
  #     target: graphql-postgres
  #     noCache: false
  #     squash: false
  #   requires:
  #     - image: builder-base
  #       alias: BASE
      
  # - image: oyelowo/grpc-mongo
  #   context: ../rust
  #   docker:
  #     dockerfile: Dockerfile.development
  #     target: grpc-mongo
  #     noCache: false
  #     squash: false
  #   requires:
  #     - image: builder-base
  #       alias: BASE
  
  # - image: builder-base
  #   context: ../rust
  #   docker:
  #     dockerfile: Dockerfile.development
  #     target: builder-base
  #     noCache: false
  #     squash: false
    # buildpacks:
    #   builder: gcr.io/buildpacks/builder:v1

deploy:
  kubectl:
    manifests:
    - rendered/namespaces/1-manifest/*
    - rendered/development/1-manifest/*

portForward:
  - resourceType: service
    resourceName: react-web
    port: 3000
    localPort: 3001

  - resourceType: service
    resourceName: graphql-mongo
    namespace: development
    port: 8000
    localPort: 8000

  # - resourceType: service
  #   resourceName: graphql-postgres
  #   port: 8000
  #   localPort: 8001

  # - resourceType: service
  #   resourceName: grpc-mongo
  #   port: 50051
  #   localPort: 50051